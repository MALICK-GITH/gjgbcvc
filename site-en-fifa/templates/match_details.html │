<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Détails du match</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; background: #f4f4f4; }
        .container { max-width: 700px; margin: auto; background: white; border-radius: 10px; box-shadow: 0 2px 8px #ccc; padding: 20px; }
        h2 { text-align: center; }
        .stats-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .stats-table th, .stats-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        .back-btn { margin-bottom: 20px; display: inline-block; }
    </style>
</head><body>
    <div class="container">
        <a href="/" class="back-btn">&larr; Retour à la liste</a>
        <h2>{% if team1_img %}<img src="{{team1_img}}" alt="Logo {{team1}}" style="height:32px;vertical-align:middle;"> {% endif %}{{ team1 }} vs {% if team2_img %}<img src="{{team2_img}}" alt="Logo {{team2}}" style="height:32px;vertical-align:middle;"> {% endif %}{{ team2 }}</h2>
        <p><b>Ligue :</b> {{ league }} | <b>Sport :</b> {% if sport_img %}<img src="{{sport_img}}" alt="Logo sport" style="height:24px;vertical-align:middle;"> {% endif %}{{ sport }}</p>
        <p><b>Score :</b> {{ score1 }} - {{ score2 }}</p>
        <h3>Prédiction du bot</h3>
        <div style="background:#eafaf1;padding:10px;border-radius:8px;margin-bottom:10px;">
            <b>Prédiction :</b> {{ prediction }}<br>
            {% if prediction_type and prediction_cote %}
            <b>Type :</b> {{ prediction_type }}<br>
            <b>Cote :</b> {{ prediction_cote }}<br>
            {% endif %}
            <b>Explication :</b> {{ explication }}
        </div>
        <h3>Cotes principales (1X2)</h3>
        <canvas id="oddsChart" height="100"></canvas>
        <h3>Cotes alternatives (handicaps, over/under)</h3>
        <table class="stats-table">
            <tr><th>Type</th><th>Cote</th><th>Groupe</th><th>Paramètre</th></tr>
            {% for o in alt_odds %}
            <tr><td>{{ o.type }}</td><td>{{ o.cote }}</td><td>{{ o.groupe }}</td><td>{{ o.param }}</td></tr>
            {% endfor %}
        </table>
        <h3>Statistiques principales</h3>
        <table class="stats-table">
            <tr><th>Statistique</th><th>{{ team1 }}</th><th>{{ team2 }}</th></tr>
            {% for s in stats %}
            <tr><td>{{ s.nom }}</td><td>{{ s.s1 }}</td><td>{{ s.s2 }}</td></tr>
            {% endfor %}
        </table>
        <canvas id="statsChart" height="200"></canvas>
    </div>
    <script>
        // Graphique des cotes principales (1X2)
        const oddsLabels = {{ odds_labels|tojson }};
        let oddsValues = {{ odds_values|tojson }};
        oddsValues = oddsValues.map(function(x) { return parseFloat(x); });
        // Détection de la plus petite cote (prédiction)
        const minCote = Math.min(...oddsValues);
        const bgColors = oddsValues.map(function(c) { return c === minCote ? '#e74c3c' : '#2980b9'; });
        new Chart(document.getElementById('oddsChart'), {
            type: 'bar',
            data: {
                labels: oddsLabels,
                datasets: [
                    { label: 'Cotes', data: oddsValues, backgroundColor: bgColors }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Cote : ' + context.parsed.y;
                            }
                        }
                    }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
        // Graphique des statistiques principales
        const labels = {{ stats|map(attribute='nom')|list|tojson }};
        let data1 = {{ stats|map(attribute='s1')|list|tojson }};
        let data2 = {{ stats|map(attribute='s2')|list|tojson }};
        data1 = data1.map(function(x) { return parseFloat(x); });
        data2 = data2.map(function(x) { return parseFloat(x); });
        new Chart(document.getElementById('statsChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    { label: '{{ team1 }}', data: data1, backgroundColor: 'rgba(44,62,80,0.7)' },
                    { label: '{{ team2 }}', data: data2, backgroundColor: 'rgba(39,174,96,0.7)' }
                ]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' } },
                scales: { y: { beginAtZero: true } }
            }
        });
    </script>
</body></html> 
